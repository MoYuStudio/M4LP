# M4LP 四足机器人仿真项目

## 项目简介

M4LP是一个基于PyBullet物理引擎的四足机器人仿真项目。该机器人具有四个带有轮子的腿部，支持多种运动模式：静止模式（轮子驱动）和踏步模式（循环踏步）。

## 机器人规格

- **车身**: 60cm × 25cm × 15cm，薄荷绿色，8.0kg
- **大腿**: 19cm长，浅柠檬黄色，0.8kg/条
- **小腿**: 25cm长，浅柠檬黄色，0.6kg/条
- **轮子**: 直径10cm，厚度4cm，黑色，0.4kg/个
- **髋关节**: 0.3kg/个
- **关节**: 270度旋转范围，前后方向运动
- **关节标记**: 灰色圆柱体，前后竖立
- **总重量**: 约15.6kg

## 环境要求

```bash
pip install pybullet
```

## 文件结构

```
M4LP/
├── m4lp.urdf          # 机器人URDF模型文件
├── main.py            # 主控制程序
└── README.md          # 项目说明文档
```

## 快速开始

1. **克隆或下载项目文件**
2. **安装依赖**
   ```bash
   pip install pybullet
   ```
3. **运行仿真**
   ```bash
   python main.py
   ```

## 操作控制

### 模式切换

| 按键 | 功能 | 说明 |
|------|------|------|
| **1** | 静止模式 | 轮子驱动模式，支持移动控制 |
| **2** | 踏步模式 | 循环踏步模式，停止轮子驱动 |

### 移动控制（静止模式下）

| 按键 | 功能 | 说明 |
|------|------|------|
| **I** | 前进 | 按住I键持续前进 |
| **K** | 后退 | 按住K键持续后退 |
| **J** | 左转 | 按住J键持续左转 |
| **L** | 右转 | 按住L键持续右转 |
| **空格键** | 停止 | 立即停止所有移动 |

### 姿态调整

| 按键 | 功能 | 说明 |
|------|------|------|
| **U** | 升高机器人 | 增加机器人整体高度 |
| **O** | 降低机器人 | 减少机器人整体高度 |

### 其他控制

| 按键 | 功能 | 说明 |
|------|------|------|
| **Ctrl+C** | 退出 | 退出仿真程序 |

### 控制特点

- **双模式设计**: 静止模式和踏步模式可随时切换
- **连续控制**: 按住按键可以持续移动，松开按键自动停止
- **组合操作**: 支持同时按下多个键进行复合移动（如前进+左转）
- **差速转向**: 实现类似汽车的差速转向系统
- **实时反馈**: 每3秒显示机器人状态信息
- **高度调节**: 可实时调整机器人整体高度

## 技术特性

### 物理仿真
- 使用PyBullet物理引擎
- 真实的重力和摩擦力模拟
- 碰撞检测和响应

### 运动控制
- 四轮独立驱动
- 差速转向算法
- 四足屈膝稳定姿态保持
- 关节位置控制
- 低重心设计，提高稳定性
- 双模式运动系统

### 踏步模式特性
- **循环踏步**: 两条循环模式交替切换
- **斜角腿同步**: FL+RR一组，FR+RL一组
- **高速踏步**: 6Hz踏步频率
- **伸腿值控制**: 0.1-0.5范围的伸腿值循环

### 轮子配置
- 前左轮 (FL_wheel_joint)
- 前右轮 (FR_wheel_joint)  
- 后左轮 (RL_wheel_joint)
- 后右轮 (RR_wheel_joint)

## 程序功能

### 主要功能模块

1. **机器人加载与初始化**
   - 加载URDF模型
   - 设置物理参数
   - 配置轮子摩擦系数
   - 伸腿值转换系统

2. **键盘事件处理**
   - 实时键盘输入检测
   - 避免与PyBullet默认功能冲突
   - 连续按键支持
   - 模式切换控制

3. **双模式运动控制**
   - **静止模式**: 差速转向计算，轮子速度分配
   - **踏步模式**: 循环踏步算法，伸腿值控制
   - 四足屈膝稳定控制
   - 低重心姿态保持
   - 高度调整功能

4. **状态监控**
   - 位置信息显示
   - 速度监控
   - 姿态角度显示
   - 模式状态显示
   - 高度调整状态

## 参数调节

可以在代码中调整以下参数来优化性能：

### 移动控制参数
```python
max_speed = 24.0    # 最大前进/后退速度
turn_speed = 8.0    # 转向速度
time_step = 0.01    # 仿真时间步长
```

### 踏步模式参数
```python
step_frequency = 6.0       # 踏步频率 (Hz)
step_cycle_1 = [0.1, 0.5, 0.5, 0.1]  # 第一组循环：FL, FR, RL, RR
step_cycle_2 = [0.5, 0.1, 0.1, 0.5]  # 第二组循环：FL, FR, RL, RR
```

### 姿态控制参数
```python
FL_EXTEND = 0.3    # 左前腿伸腿值 (0=屈膝, 1=站立)
FR_EXTEND = 0.3    # 右前腿伸腿值
RL_EXTEND = 0.3    # 左后腿伸腿值
RR_EXTEND = 0.3    # 右后腿伸腿值
height_step = 0.1  # 高度调整步长
```

## 故障排除

### 常见问题

1. **键盘无响应**
   - 确保PyBullet窗口处于焦点状态
   - 检查按键是否与系统快捷键冲突

2. **机器人移动异常**
   - 检查URDF文件是否正确加载
   - 调整摩擦系数参数

3. **仿真卡顿**
   - 减小time_step值
   - 关闭不必要的后台程序

## 开发说明

### 扩展功能

可以基于当前代码扩展以下功能：

- 添加传感器模拟
- 实现自动导航
- 增加更多移动模式
- 添加遥控器支持

### 代码结构

```python
# 主要函数说明
set_stable_pose()        # 设置初始稳定姿态
check_keyboard_input()   # 键盘输入检测
wheel_drive_control()    # 轮子驱动控制（双模式）
step_mode_control()      # 踏步模式控制
extend_to_joint_angles() # 伸腿值转换关节角度
```

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请通过GitHub Issues联系。

---

**享受您的M4LP四足机器人仿真体验！**
